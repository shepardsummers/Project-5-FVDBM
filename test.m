ksi = [0 1 0 -1 0 1 -1 -1 1; ...
       0 0 1 0 -1 1 1 -1 -1 ];

w = [4/9 1/9 1/9 1/9 1/9 1/36 1/36 1/36 1/36];

c_s = 1/sqrt(3); % speed of sound (D2Q9)

rho = zeros(1, 2, 3);
rho(1,:,:) = [2 2 2; 2 2 2];

%U = [[1 2 3; 4 5 6;]; [7 8 9; 10 11 12]];
u = zeros(2, 2, 3);
u(1, :, :) = [1 2 3; 4 5 6];
u(2, :, :) = [7 8 9; 10 11 12];

guh = (1 + pagemtimes(ksi',u)/(1/3) + (pagemtimes(ksi',u).^2)/(2/9) - sum(u.^2, 1)/(2/3));

f_eq = rho.*(guh .* w');