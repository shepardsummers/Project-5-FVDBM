clc, clear;

% computes interior flux
f = [1.67; 0.43; 0.42; 0.4; 0.42; 0.11; 0.1; 0.1; 0.11];
f_n = [1.63 1.67 1.55 1.66; ...
       0.61 0.42 0.77 0.50; ...
       0.41 0.42 0.39 0.42; ...
       0.27 0.42 0.20 0.35; ...
       0.41 0.42 0.39 0.42; ...
       0.15 0.10 0.19 0.12; ...
       0.07 0.11 0.05 0.09; ...
       0.07 0.10 0.05 0.08; ...
       0.16 0.11 0.20 0.13
      ];
ksi = [0  1  0 -1  0  1 -1 -1  1; ...
       0  0  1  0 -1  1  1 -1 -1];
L = [0.8, 1.2, 0.8, 1.2];
n = [1  0 -1  0; ...
     0  1  0 -1];
kdn = ksi'*n;

f_t = (max(kdn, 0)~=0).*f + (min(kdn, 0)~=0).*f_n;

flux = sum(f_t.*(ksi'*n).*L, 2);